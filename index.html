<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>RTU ì‹¤ì‹œê°„ ì˜¨ë„ ëª¨ë‹ˆí„°ë§</title>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f5f6fa;
      margin: 0;
      text-align: center;
      overflow-x: hidden;
    }
    h2 {
      margin-top: 20px;
      color: #2c3e50;
    }

    /* ---------------- ì§€ë„ ì»¨í…Œì´ë„ˆ ---------------- */
    .map-wrapper {
      width: 90%;
      max-width: 900px;
      margin: 20px auto;
      border-radius: 10px;
      box-shadow: 0 0 8px #bbb;
      overflow: hidden;
      position: relative;
      background: #fff;
      cursor: grab;
    }
    #layout {
      position: relative;
      transform-origin: center center;
      transition: transform 0.1s ease-out;
    }
    #layout img {
      width: 100%;
      border-radius: 10px;
      display: block;
    }

    /* ë§ˆì»¤ ìŠ¤íƒ€ì¼ */
    .marker {
      position: absolute;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: gray;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 12px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      /* ë§ˆì»¤ë¥¼ ì¤‘ì•™ì— ì •ë ¬í•˜ê¸° ìœ„í•´ ì¶”ê°€ */
      transform: translate(-50%, -50%);
    }
    .marker:hover { transform: translate(-50%, -50%) scale(1.2); }
    .marker.active {
      background: #e74c3c !important;
      box-shadow: 0 0 10px #e74c3c;
    }

    /* íŒì—… ì¹´ë“œ */
    .popup {
      position: absolute;
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.75);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      padding: 12px 14px 10px 14px;
      font-size: 0.9rem;
      color: #333;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
      min-width: 150px;
      z-index: 10;
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translate(-50%, 0); }
      to { opacity: 1; transform: translate(-50%, 10px); }
    }

    .popup h4 {
      margin: 0;
      color: #2c3e50;
      font-size: 1rem;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .close-btn {
      border: none;
      background: none;
      color: #555;
      font-size: 1rem;
      cursor: pointer;
      padding: 0;
      margin-left: 10px;
      transition: 0.2s;
    }
    .close-btn:hover { color: #e74c3c; transform: scale(1.2); }

    .popup .temp {
      display: flex;
      justify-content: space-between;
      font-weight: 600;
      margin-top: 5px;
    }

    .blue { color: #3498db; }
    .black { color: #2c3e50; }
    .red { color: #e74c3c; }

    /* ---------------- í‘œ ---------------- */
    .table-container {
      width: 90%;
      max-width: 900px;
      margin: 30px auto 60px auto;
      max-height: 450px;
      overflow-y: auto;
      background: white;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px 12px;
      border-bottom: 1px solid #eee;
    }
    th {
      background: #3498db;
      color: white;
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 2;
    }
    td { text-align: center; }
    tr:last-child td { border-bottom: none; }

    .highlight {
      background: #fff9c4;
      transition: background 0.5s;
    }

    button.select-btn {
      padding: 4px 8px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: 0.2s;
    }
    button.select-btn:hover {
      background: #2980b9;
    }

    /* ë¦¬ì…‹ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
    button.reset-btn {
      padding: 4px 8px;
      background: #e74c3c; /* í‰ìƒì‹œ: ë¹¨ê°„ìƒ‰ */
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: 0.3s;
      width: 55px; /* ë²„íŠ¼ í¬ê¸° ê³ ì • */
    }
    button.reset-btn:hover {
      background: #c0392b;
    }
    /* ë¦¬ì…‹ ì§„í–‰ ì¤‘ ìŠ¤íƒ€ì¼ */
    button.reset-btn.resetting {
      background: #f39c12; /* ë¦¬ì…‹ ì¤‘: ì£¼í™©ìƒ‰ */
      cursor: not-allowed;
      animation: pulsate 1s infinite alternate; /* ê¹œë¹¡ì„ íš¨ê³¼ */
    }
    
    @keyframes pulsate {
        from { opacity: 1; }
        to { opacity: 0.7; }
    }
  </style>
</head>
<body>
  <h2>RTU ì‹¤ì‹œê°„ ì˜¨ë„ ëª¨ë‹ˆí„°ë§</h2>

  <div class="map-wrapper" id="mapWrapper">
    <div id="layout">
      <img src="layout.jpg" alt="Layout" id="layout-img">
      </div>
  </div>

  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>ì„ íƒ</th>
          <th>ìœ ë‹›</th>
          <th>ì¦ë°œê¸° ì˜¨ë„ (Â°F)</th>
          <th>ê³µê¸‰ê¸° ì˜¨ë„ (Â°F)</th>
          <th>ë¦¬ì…‹</th> </tr>
      </thead>
      <tbody id="unit-table"></tbody>
    </table>
  </div>

  <script>
    // ---------------- MQTT SETUP ----------------
    const client = mqtt.connect("wss://3f34159555984b35a539f803505dc858.s1.eu.hivemq.cloud:8884/mqtt", {
      username: "Goodmansystemllc",
      password: "Good7071**"
    });

    // ---------------- UNIT DATA (From image_map_markers.json) ----------------
    const unitMarkersData = [
      {"unit": "UNIT1", "x1": 402, "y1": 2431, "x2": 488, "y2": 2533},
      {"unit": "UNIT2", "x1": 546, "y1": 2424, "x2": 655, "y2": 2525},
      {"unit": "UNIT3", "x1": 1053, "y1": 2446, "x2": 1263, "y2": 2554},
      {"unit": "UNIT4", "x1": 1596, "y1": 2431, "x2": 1769, "y2": 2554},
      {"unit": "UNIT5", "x1": 2023, "y1": 2446, "x2": 2175, "y2": 2540},
      {"unit": "UNIT6", "x1": 2840, "y1": 2438, "x2": 3072, "y2": 2547},
      {"unit": "UNIT7", "x1": 394, "y1": 326, "x2": 510, "y2": 434},
      {"unit": "UNIT8", "x1": 742, "y1": 311, "x2": 959, "y2": 398},
      {"unit": "UNIT9", "x1": 1038, "y1": 304, "x2": 1219, "y2": 405},
      {"unit": "UNIT10", "x1": 1321, "y1": 318, "x2": 1523, "y2": 412},
      {"unit": "UNIT11A", "x1": 3101, "y1": 87, "x2": 3224, "y2": 174},
      {"unit": "UNIT12", "x1": 2196, "y1": 304, "x2": 2399, "y2": 427},
      {"unit": "UNIT13", "x1": 568, "y1": 550, "x2": 633, "y2": 630},
      {"unit": "UNIT14", "x1": 554, "y1": 876, "x2": 640, "y2": 941},
      {"unit": "UNIT15", "x1": 4020, "y1": 456, "x2": 4100, "y2": 535},
      {"unit": "UNIT16", "x1": 4375, "y1": 456, "x2": 4461, "y2": 535},
      {"unit": "UNIT17", "x1": 4613, "y1": 434, "x2": 4722, "y2": 514},
      {"unit": "UNIT18", "x1": 3535, "y1": 760, "x2": 3673, "y2": 854},
      {"unit": "UNIT19", "x1": 4085, "y1": 753, "x2": 4215, "y2": 868},
      {"unit": "UNIT20", "x1": 4613, "y1": 767, "x2": 4736, "y2": 847},
      {"unit": "UNIT21", "x1": 5142, "y1": 745, "x2": 5279, "y2": 868},
      {"unit": "UNIT22", "x1": 5641, "y1": 731, "x2": 5815, "y2": 868},
      {"unit": "UNIT23", "x1": 4606, "y1": 1389, "x2": 4729, "y2": 1476},
      {"unit": "UNIT24", "x1": 5402, "y1": 1375, "x2": 5532, "y2": 1469},
      {"unit": "UNIT25", "x1": 3542, "y1": 1983, "x2": 3694, "y2": 2098},
      {"unit": "UNIT26", "x1": 4071, "y1": 1983, "x2": 4237, "y2": 2091},
      {"unit": "UNIT27", "x1": 4606, "y1": 1968, "x2": 4751, "y2": 2091},
      {"unit": "UNIT28", "x1": 5142, "y1": 1983, "x2": 5279, "y2": 2077},
      {"unit": "UNIT29", "x1": 5684, "y1": 1961, "x2": 5822, "y2": 2077},
      {"unit": "UNIT30", "x1": 3535, "y1": 1585, "x2": 3731, "y2": 1700},
      {"unit": "UNIT31", "x1": 4092, "y1": 1650, "x2": 4252, "y2": 1766},
      {"unit": "UNIT32", "x1": 6263, "y1": 745, "x2": 6394, "y2": 897},
      {"unit": "UNIT33", "x1": 6336, "y1": 1389, "x2": 6473, "y2": 1556},
      {"unit": "UNIT34", "x1": 6314, "y1": 1917, "x2": 6415, "y2": 2048},
      {"unit": "UNIT11B", "x1": 3014, "y1": 333, "x2": 3181, "y2": 405}
    ];

    // ì§€ë„ ì›ë³¸ í¬ê¸° ì„¤ì • (JSON ì¢Œí‘œì˜ ìµœëŒ€ê°’ì— ê·¼ê±°í•˜ì—¬ ì •í™•í•œ ë¹„ìœ¨ ê³„ì‚°)
    const mapWidth = 8192; 
    const mapHeight = 5586; 

    // ---------------- GLOBAL STATE ----------------
    const lastUpdate = {};
    const temps = {};
    let activePopup = null;
    const unitIdMap = {}; // short ID ('1', '11A') -> full unitName ('UNIT1', 'UNIT11A')

    // ---------------- HELPER FUNCTIONS ----------------
    // ìƒ‰ìƒ ë¡œì§
    function getColor(role, temp) {
      temp = parseFloat(temp);
      if (isNaN(temp)) return "black";
      if (role === "evap") {
        if (temp < 32) return "blue";
        else if (temp <= 65) return "black";
        else return "red";
      } else {
        if (temp <= 76) return "blue";
        else if (temp <= 80) return "black";
        else return "red";
      }
    }

    const tableBody = document.getElementById("unit-table");
    const layoutDiv = document.getElementById("layout");

    // ë§µ ë§ˆì»¤ ìƒì„± ë° ìœ„ì¹˜ ì„¤ì •
    function createMarkers() {
      unitMarkersData.forEach(unitData => {
        // Calculate the center coordinates
        const centerX = (unitData.x1 + unitData.x2) / 2;
        const centerY = (unitData.y1 + unitData.y2) / 2;

        // Calculate the percentage position
        const leftPercent = (centerX / mapWidth) * 100;
        const topPercent = (centerY / mapHeight) * 100;

        const unitName = unitData.unit;
        // Display ID: e.g., "UNIT1" -> "1", "UNIT11A" -> "11A"
        const displayId = unitName.replace('UNIT', '');
        
        const marker = document.createElement("div");
        marker.className = "marker";
        marker.id = `marker-${unitName}`;
        marker.textContent = displayId;
        marker.style.left = `${leftPercent}%`;
        marker.style.top = `${topPercent}%`;
        
        // Attach click listener
        marker.addEventListener("click", () => {
          showPopup(unitName, marker);
        });
        
        layoutDiv.appendChild(marker);
      });
    }

    // í‘œ ìƒì„± ë° MQTT êµ¬ë… ì„¤ì •
    function setupUnits() {
      unitMarkersData.forEach(unitData => {
        const unitName = unitData.unit;
        const displayId = unitName.replace('UNIT', '');
        
        // 1. Map creation for message handling
        unitIdMap[displayId] = unitName;
        
        // 0. ë¦¬ì…‹ ìƒíƒœ Topic êµ¬ë… ì¶”ê°€
        client.subscribe(`ac/status/${unitName}`); 

        // Create table row
        const tr = document.createElement("tr");
        tr.id = `row-${unitName}`;
        tr.innerHTML = `
          <td><button class="select-btn" onclick="showPopup('${unitName}', document.getElementById('marker-${unitName}'))">ì„ íƒ</button></td>
          <td>${displayId}</td>
          <td><span id="evap-${unitName}" class="black">--</span></td>
          <td><span id="supply-${unitName}" class="black">--</span></td>
          <td><button class="reset-btn" id="reset-btn-${unitName}" onclick="requestReset('${unitName}')">ë¦¬ì…‹</button></td>
        `; // ë¦¬ì…‹ ë²„íŠ¼ ì¶”ê°€
        tableBody.appendChild(tr);

        // 2. Subscribe to MQTT topics using the correct short ID
        client.subscribe(`ac/temperature/evap-${displayId}`); 
        client.subscribe(`ac/temperature/supply-${displayId}`);
        
        if (!temps[unitName]) temps[unitName] = { evap: "--", supply: "--" };
      });
    }
    
    // Start setup when the image is loaded
    document.getElementById("layout-img").onload = () => {
      createMarkers();
      setupUnits();
    };

    // Fallback if the image loads too fast or is cached
    if (document.getElementById("layout-img").complete) {
      createMarkers();
      setupUnits();
    }

    // ---------------- MQTT EVENT HANDLERS ----------------
    client.on("connect", () => {
      console.log("âœ… MQTT ì—°ê²°ë¨");
    });

    // ë°ì´í„° ìˆ˜ì‹ 
    client.on("message", (topic, message) => {
      try {
        // ---------------- ë¦¬ì…‹ ìƒíƒœ ì²˜ë¦¬ ë¡œì§ ----------------
        if (topic.startsWith("ac/status/")) {
            const unitNameFromStatus = topic.split('/').pop(); // 'UNIT1' ì¶”ì¶œ
            const status = message.toString(); // 'resetting' ë˜ëŠ” 'done'
            
            if (status === 'resetting' || status === 'done') {
                updateResetButtonState(unitNameFromStatus, status);
                console.log(`â„¹ï¸ [${unitNameFromStatus}] ìƒíƒœ: ${status}`);
                return; // ìƒíƒœ ë©”ì‹œì§€ëŠ” ì˜¨ë„ ë°ì´í„°ê°€ ì•„ë‹ˆë¯€ë¡œ ì—¬ê¸°ì„œ ì¢…ë£Œ
            }
        }
        // ---------------- ì˜¨ë„ ë°ì´í„° ì²˜ë¦¬ ë¡œì§ ----------------

        const data = JSON.parse(message.toString());
        const role = topic.includes("evap") ? "evap" : "supply";
        
        // Topic ID: '1', '11A' ë“± ì§§ì€ ID ì¶”ì¶œ
        const topicId = topic.split("-").pop(); 
        
        // full unitName: 'UNIT1', 'UNIT11A'ë¡œ ë³€í™˜
        const unitName = unitIdMap[topicId]; 
        
        if (!unitName) {
            console.error(`ğŸ”´ Unrecognized Topic ID: ${topicId}. Topic: ${topic}`);
            return; 
        }
        
        const temp = data.temp_f;

        if (!temps[unitName]) temps[unitName] = { evap: "--", supply: "--" };
        temps[unitName][role] = temp.toFixed(1);
        lastUpdate[`${role}-${unitName}`] = Date.now();

        const el = document.getElementById(`${role}-${unitName}`);
        if (el) {
          el.textContent = temp.toFixed(1);
          el.className = getColor(role, temp);
        }
        if (activePopup && activePopup.dataset.unit == unitName) updatePopupContent(unitName);
      } catch (e) {
        console.error("ë°ì´í„° ì˜¤ë¥˜:", e);
      }
    });

    // ---------------- ë¦¬ì…‹ ë²„íŠ¼ ë¡œì§ ----------------

    /**
     * íŠ¹ì • ìœ ë‹›ì— ë¦¬ì…‹ ëª…ë ¹ì„ ì „ì†¡í•˜ê³  ë²„íŠ¼ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
     * @param {string} unitName - ì „ì²´ ìœ ë‹› ì´ë¦„ (ì˜ˆ: 'UNIT1')
     */
    function requestReset(unitName) {
        const topic = `ac/reset/${unitName}`;
        const btn = document.getElementById(`reset-btn-${unitName}`);

        if (btn && btn.classList.contains('resetting')) {
            console.warn(`[${unitName}] ì´ë¯¸ ë¦¬ì…‹ ì¤‘ì…ë‹ˆë‹¤.`);
            return;
        }

        if (confirm(`ì •ë§ë¡œ ${unitName}ì„(ë¥¼) ë¦¬ì…‹í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (1ë¶„ê°„ ì „ì› ì°¨ë‹¨)`)) {
            client.publish(topic, "reset", { qos: 1 });
            console.log(`ğŸ“¤ [${topic}] reset ëª…ë ¹ ì „ì†¡`);
            
            // ë¦¬ì…‹ ìš”ì²­ ì¦‰ì‹œ ë²„íŠ¼ ìƒ‰ìƒì„ ë³€ê²½í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ í”¼ë“œë°± ì œê³µ
            updateResetButtonState(unitName, 'resetting');
        }
    }


    /**
     * ë¦¬ì…‹ ë²„íŠ¼ì˜ ìŠ¤íƒ€ì¼ê³¼ í…ìŠ¤íŠ¸ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
     * @param {string} unitName - ì „ì²´ ìœ ë‹› ì´ë¦„
     * @param {string} state - 'resetting', 'done', or 'ready'
     */
    function updateResetButtonState(unitName, state) {
        const btn = document.getElementById(`reset-btn-${unitName}`);
        if (!btn) return;
        
        // ê¸°ì¡´ íƒ€ì´ë¨¸ í´ë¦¬ì–´
        if (btn.dataset.timerId) {
            clearInterval(parseInt(btn.dataset.timerId));
            delete btn.dataset.timerId;
        }

        btn.classList.remove('resetting');
        btn.disabled = false;
        btn.textContent = "ë¦¬ì…‹";

        if (state === 'resetting') {
            btn.classList.add('resetting');
            btn.disabled = true;
            btn.textContent = "ë¦¬ì…‹ ì¤‘ (60s)";
            
            // ì¹´ìš´íŠ¸ ë‹¤ìš´ íƒ€ì´ë¨¸ (ì„ íƒ ì‚¬í•­)
            let count = 60;
            const timer = setInterval(() => {
                count--;
                btn.textContent = `ë¦¬ì…‹ ì¤‘ (${count}s)`;
                if (count <= 0) {
                    clearInterval(timer);
                    // ì¹´ìš´íŠ¸ ë‹¤ìš´ì´ ëë‚¬ì–´ë„, ì‹¤ì œ ìƒíƒœëŠ” MQTT ë©”ì‹œì§€(done)ë¥¼ ê¸°ë‹¤ë¦¼
                    btn.textContent = "ì™„ë£Œ ëŒ€ê¸°";
                }
            }, 1000);
            // íƒ€ì´ë¨¸ ID ì €ì¥
            btn.dataset.timerId = timer; 

        } else if (state === 'done') {
            btn.textContent = "ì™„ë£Œ âœ…";
            
            // ì ì‹œ í›„ ë²„íŠ¼ì„ ì •ìƒ ìƒíƒœë¡œ ë³µêµ¬
            setTimeout(() => {
                btn.textContent = "ë¦¬ì…‹";
            }, 3000); 
        }
    }

    // ---------------- POPUP LOGIC ----------------
    // íŒì—… ì—…ë°ì´íŠ¸
    function updatePopupContent(unitName) {
      const popup = document.querySelector(".popup");
      if (!popup) return;
      const e = temps[unitName]?.evap || "--";
      const s = temps[unitName]?.supply || "--";
      popup.querySelector(".evap").innerHTML = `ì¦ë°œê¸°: <span class="${getColor('evap', e)}">${e}</span>Â°F`;
      popup.querySelector(".supply").innerHTML = `ê³µê¸‰ê¸°: <span class="${getColor('supply', s)}">${s}</span>Â°F`;
    }

    // íŒì—… í‘œì‹œ (ìˆ˜ì • ì™„ë£Œ: ë§ˆì»¤ ì•„ë˜ 25px ìœ„ì¹˜ ê³ ì •)
    function showPopup(unitName, marker) {
      if (activePopup) closePopup();

      const popup = document.createElement("div");
      popup.className = "popup";
      popup.dataset.unit = unitName;
      
      const displayId = unitName.replace('UNIT', '');

      const evap = temps[unitName]?.evap || "--";
      const supply = temps[unitName]?.supply || "--";

      popup.innerHTML = `
        <h4>
          ${displayId}
          <button class="close-btn" onclick="closePopup()">âœ•</button>
        </h4>
        <div class="temp evap">ì¦ë°œê¸°: <span class="${getColor('evap', evap)}">${evap}</span>Â°F</div>
        <div class="temp supply">ê³µê¸‰ê¸°: <span class="${getColor('supply', supply)}">${supply}</span>Â°F</div>
      `;

      // Use the marker's percentage position
      const markerLeft = parseFloat(marker.style.left);
      const markerTop = parseFloat(marker.style.top);
      
      popup.style.left = `${markerLeft}%`;
      popup.style.top = `${markerTop}%`; 
      
      // ë§ˆì»¤ ì¤‘ì•™(translateY(-50%))ì—ì„œ ì‹œì‘í•˜ì—¬ ë§ˆì»¤ í¬ê¸°(28px)ë¥¼ ê³ ë ¤í•´ ì•„ë˜ë¡œ 25pxë§Œí¼ ì´ë™í•©ë‹ˆë‹¤.
      // ì´ë¡œì¨ í™•ëŒ€/ì¶•ì†Œì™€ ê´€ê³„ì—†ì´ íŒì—…ì´ ë§ˆì»¤ì˜ í•˜ë‹¨ì— ì •í™•íˆ ìœ„ì¹˜í•˜ê²Œ ë©ë‹ˆë‹¤.
      popup.style.transform = 'translate(-50%, 25px)'; 


      document.getElementById("layout").appendChild(popup);
      activePopup = popup;

      // Highlight the corresponding table row
      const row = document.getElementById(`row-${unitName}`);
      if (row) {
        row.classList.add("highlight");
        setTimeout(() => row.classList.remove("highlight"), 1500);
      }
    }

    function closePopup() {
      if (activePopup) {
        activePopup.remove();
        activePopup = null;
      }
    }
    
    // ---------------- ZOOM & DRAG LOGIC ----------------
    const layout = document.getElementById("layout");
    const mapWrapper = document.getElementById("mapWrapper");
    let scale = 1, posX = 0, posY = 0, startX, startY, dragging = false;

    mapWrapper.addEventListener("wheel", (e) => {
      e.preventDefault();
      const delta = e.deltaY > 0 ? -0.1 : 0.1;
      scale = Math.min(Math.max(scale + delta, 0.5), 3);
      layout.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;
    });

    mapWrapper.addEventListener("mousedown", (e) => {
      dragging = true;
      mapWrapper.style.cursor = "grabbing";
      startX = e.clientX - posX;
      startY = e.clientY - posY;
    });

    mapWrapper.addEventListener("mousemove", (e) => {
      if (!dragging) return;
      posX = e.clientX - startX;
      posY = e.clientY - startY;
      layout.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;
    });

    mapWrapper.addEventListener("mouseup", () => {
      dragging = false;
      mapWrapper.style.cursor = "grab";
    });

    mapWrapper.addEventListener("mouseleave", () => {
      dragging = false;
      mapWrapper.style.cursor = "grab";
    });
  </script>
</body>
</html>